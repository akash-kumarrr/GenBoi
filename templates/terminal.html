<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Core | New Chat</title>
    <style>
        :root {
            --accent: #76b900; /* NVIDIA Green */
            --bg-deep: #000000;
            --panel-bg: rgba(15, 15, 15, 0.95);
            --border-color: #1a1a1a;
            --text-dim: #888;
            --text-bright: #fff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-deep);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-bright);
            background-image: radial-gradient(circle at 50% 10%, #111 0%, #000 70%);
        }

        /* ===== LOGOUT MODAL OVERLAY ===== */
.logout-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 5000;
}

.logout-overlay.active {
    display: flex;
}

/* BOX */
.logout-box {
    background: #050505;
    border: 1px solid #1a1a1a;
    border-radius: 22px;
    padding: 30px 40px;
    width: 360px;
    text-align: center;
    box-shadow: 0 30px 80px rgba(0,0,0,0.9);
    animation: popIn 0.35s ease;
}

@keyframes popIn {
    from { transform: scale(0.85); opacity: 0; }
    to { transform: scale(1); opacity: 1; }
}

.logout-title {
    font-size: 0.85rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: #aaa;
    margin-bottom: 28px;
}

/* ACTIONS */
.logout-actions {
    display: flex;
    justify-content: center;
    gap: 26px;
}

/* BUTTON BASE */
.logout-actions button {
    width: 54px;
    height: 54px;
    border-radius: 50%;
    border: none;
    cursor: pointer;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.25s;
}

.logout-actions svg {
    width: 22px;
    height: 22px;
    stroke: currentColor;
    fill: none;
    stroke-width: 2.6;
}

/* CONFIRM */
.logout-confirm {
    color: #76b900;
    border: 1px solid #1f3b00;
}

.logout-confirm:hover {
    background: #76b900;
    color: #000;
    box-shadow: 0 0 22px rgba(118, 185, 0, 0.8);
    animation: blinkGlow 0.8s infinite;
}

/* CANCEL */
.logout-cancel {
    color: #ff3b3b;
    border: 1px solid #3b0000;
}

.logout-cancel:hover {
    background: #ff3b3b;
    color: #000;
    box-shadow: 0 0 22px rgba(255, 59, 59, 0.8);
    animation: blinkGlow 0.8s infinite;
}


        /* --- CHAT CONTAINER --- */
        .chat-shell {
            width: 90vw;
            max-width: 900px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 24px;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
            overflow: hidden;
            position: relative;
        }

        /* --- TOP HEADER --- */
        .chat-header {
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-pill {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--accent);
        }
/* ===== BOTTOM USER PANEL (UPDATED) ===== */
.user-panel {
     position: fixed;
    bottom: 20px;
    right: 20px;              /* ✅ moved to bottom-right */
    left: auto;
    transform: none;

    display: flex;
    align-items: center;
    justify-content: space-between; /* buttons pushed to corners */
    gap: 24px;

    width: 260px;             /* ✅ increased width */
    background: rgba(10, 10, 10, 0.9);
    border: 1px solid #1a1a1a;
    padding: 12px 20px;
    border-radius: 22px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.8);
    z-index: 999;
}

/* PROFILE AREA */
.profile-box {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
}

.profile-btn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: #050505;
    border: 1px solid #1a1a1a;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent);
    transition: 0.25s;
}

/* PROFILE BLINK + GLOW */
.profile-box:hover .profile-btn {
    background: var(--accent);
    color: #000;
    box-shadow: 0 0 18px rgba(118, 185, 0, 0.75);
    animation: blinkGlow 0.9s infinite;
}

@keyframes blinkGlow {
    0% { opacity: 1; }
    50% { opacity: 0.55; }
    100% { opacity: 1; }
}

.profile-name {
    font-size: 0.85rem;
    letter-spacing: 1px;
    color: #e6e6e6;
}

/* LOGOUT BUTTON */
.logout-btn {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: #120000;
    border: 1px solid #330000;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: 0.25s;
    color: #ff3b3b;
}

.logout-btn:hover {
    background: #ff3b3b;
    color: #000;
    box-shadow: 0 0 16px rgba(255, 59, 59, 0.65);
}

        .status-dot {
            width: 8px; height: 8px; background: var(--accent); border-radius: 50%;
            box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }

        /* --- MESSAGING AREA --- */
        .message-viewport {
            flex-grow: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        /* Custom Scrollbar */
        .message-viewport::-webkit-scrollbar { width: 4px; }
        .message-viewport::-webkit-scrollbar-track { background: transparent; }
        .message-viewport::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 10px; }

        .msg-row { display: flex; flex-direction: column; max-width: 85%; }
        .msg-user { align-self: flex-end; align-items: flex-end; }
        .msg-ai { align-self: flex-start; }

        .msg-label { font-size: 0.65rem; text-transform: uppercase; margin-bottom: 6px; color: var(--text-dim); letter-spacing: 1px; }

        .bubble {
            padding: 14px 18px;
            border-radius: 16px;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .msg-user .bubble { background: var(--accent); color: #000; font-weight: 500; border-bottom-right-radius: 4px; }
        .msg-ai .bubble { background: #111; border: 1px solid var(--border-color); color: var(--text-bright); border-bottom-left-radius: 4px; }

        /* --- INPUT SYSTEM --- */
        .chat-input-zone {
            padding: 25px 30px;
            border-top: 1px solid var(--border-color);
            background: rgba(10, 10, 10, 0.5);
        }

        .input-wrapper {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #050505;
            border: 1px solid var(--border-color);
            padding: 8px 10px 8px 20px;
            border-radius: 18px;
            transition: 0.3s;
        }

        .input-wrapper:focus-within { border-color: var(--accent); box-shadow: 0 0 15px rgba(118, 185, 0, 0.1); }

        textarea {
            flex-grow: 1;
            background: transparent;
            border: none;
            color: #fff;
            outline: none;
            resize: none;
            height: 24px;
            font-size: 0.95rem;
            padding-top: 4px;
        }

        .action-btn {
            width: 40px; height: 40px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }

        .send-btn { background: var(--accent); }
        .send-btn:hover { transform: scale(1.05); filter: brightness(1.1); }
        .send-btn:active { transform: scale(0.95); }
        .send-btn:disabled { background: #1a1a1a; cursor: not-allowed; opacity: 0.3; }

        .clear-btn { background: transparent; border: 1px solid var(--border-color); color: var(--text-dim); }
        .clear-btn:hover { color: var(--nv-red); border-color: var(--nv-red); }

        svg { width: 20px; height: 20px; stroke: currentColor; fill: none; stroke-width: 2.5; }
    </style>

    <style>
    /* ===== USERNAME STYLING ===== */
    .profile-name {
        font-size: 0.85rem;
        letter-spacing: 1.5px;
        color: #76b900; /* NVIDIA green */
        font-weight: 600;
        text-transform: capitalize; /* first letter capital */
        margin-left: 12px; /* spacing from profile icon */
        white-space: nowrap;
        text-shadow: 0 0 6px rgba(118,185,0,0.7), 0 0 12px rgba(0,0,0,0.6);
        transition: 0.3s;
    }

    .profile-box:hover .profile-name {
        color: #fff;
        text-shadow: 0 0 8px rgba(118,185,0,1), 0 0 14px rgba(0,0,0,0.7);
        animation: blinkGlow 1s infinite;
        cursor: default;
    }
    </style>
</head>
<body>

    <div class="chat-shell">
        <header class="chat-header">
            <div class="status-pill">
                <div class="status-dot"></div>
                Nexus Engine v2.0
            </div>
            <div style="font-weight: bold; font-size: 0.9rem; letter-spacing: 2px;">TERMINAL</div>
        </header>

        <div class="message-viewport" id="chat-viewport">
            <div class="msg-row msg-ai">
                <span class="msg-label">System Synthesis</span>
                <div class="bubble">Nexus Core initialized. All systems green. How can I assist your workflow today?</div>
            </div>
        </div>
<!-- ===== USER CONTROL PANEL ===== -->
<section class="user-panel">

    <!-- PROFILE (LEFT) -->
     <a href="/profile">
       <div class="profile-box">
            <div class="profile-btn">
                <svg viewBox="0 0 24 24" width="22" height="22" fill="none"
                    stroke="currentColor" stroke-width="2.5">
                    <circle cx="12" cy="7" r="4"/>
                    <path d="M5.5 21a6.5 6.5 0 0 1 13 0"/>
                </svg>
            </div>

            <!-- USERNAME TEXT -->
            <div class="profile-name" id="profileName">{{ session['active_name'] }}</div>
        </div>
     </a>
    

    <!-- LOGOUT (RIGHT) -->
        <button onclick="openLogout()" class="logout-btn" title="Logout">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none"
                stroke="currentColor" stroke-width="2.5">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
        </button>

</section>

        <div class="chat-input-zone">
            <div class="input-wrapper">
                <button class="action-btn clear-btn" title="Reset Session" onclick="clearChat()">
                    <svg viewBox="0 0 24 24"><path d="M3 6h18m-2 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>
                </button>
                
                <textarea id="main-input" placeholder="Enter command..." oninput="toggleButton()"></textarea>
                
                <button class="action-btn send-btn" id="send-trigger" disabled onclick="sendMessage()">
                    <svg style="stroke: #000;" viewBox="0 0 24 24"><polyline points="9 18 15 12 9 6"></polyline></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ===== LOGOUT CONFIRM OVERLAY ===== -->
    <div class="logout-overlay" id="logoutOverlay">
        <div class="logout-box">

            <div class="logout-title">
                Confirm Logout
            </div>

            <div class="logout-actions">
                <!-- CONFIRM -->
                <form method="POST" action="/">
                    <button class="logout-confirm" title="Confirm Logout">
                        <svg viewBox="0 0 24 24">
                            <polyline points="5 13 9 17 19 7"></polyline>
                        </svg>
                    </button>
                </form>

                <!-- CANCEL -->
                <button class="logout-cancel" onclick="closeLogout()" title="Cancel">
                    <svg viewBox="0 0 24 24">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>

        </div>
    </div>

    <script>
        const input = document.getElementById('main-input');
        const sendBtn = document.getElementById('send-trigger');
        const viewport = document.getElementById('chat-viewport');

        function toggleButton() {
            sendBtn.disabled = input.value.trim() === "";
        }

        async function sendMessage() {
            const text = input.value.trim();
            if(!text) return;

            // 1. Add User Message
            const userRow = document.createElement('div');
            userRow.className = 'msg-row msg-user';
            userRow.innerHTML = `<span class="msg-label">User Input</span><div class="bubble">${text}</div>`;
            viewport.appendChild(userRow);

            // 2. Clear Input
            input.value = "";
            toggleButton();

            // 3. Scroll to bottom
            viewport.scrollTop = viewport.scrollHeight;

            // 4. Send to Backend
            try {
                const response = await fetch('/terminal', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: text })
                });
                const data = await response.json();

                const aiRow = document.createElement('div');
                aiRow.className = 'msg-row msg-ai';
                aiRow.innerHTML = `<span class="msg-label">System Synthesis</span><div class="bubble">${data.response}</div>`;
                viewport.appendChild(aiRow);
                viewport.scrollTop = viewport.scrollHeight;
            } catch (err) {
                console.error("Error:", err);
            }
        }

        function clearChat() {
            viewport.innerHTML = `<div class="msg-row msg-ai"><span class="msg-label">System Synthesis</span><div class="bubble">Memory purged. Session restarted.</div></div>`;
        }

        function openLogout() {
            document.getElementById('logoutOverlay').classList.add('active');
            document.body.style.pointerEvents = 'none';
            document.getElementById('logoutOverlay').style.pointerEvents = 'all';
        }

        function closeLogout() {
            document.getElementById('logoutOverlay').classList.remove('active');
            document.body.style.pointerEvents = 'auto';
        }

    </script>

    
</body>
</html>